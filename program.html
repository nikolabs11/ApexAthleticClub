<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Program - Apex Athletic Club</title>
    <link rel="stylesheet" href="program.css">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.cells.min.js"></script>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("orACw4cPmMD066o2G");
        })();
    </script>
</head>
<body>
    <div id="vanta-bg"></div>
    <div id="overlay">
        <div id="logo-container">
            <a href="/">
                <img id="club-logo" src="images/AAC Logo.png" alt="Apex Athletic Club Logo">
            </a>
        </div>
        
        <!-- Welcome section on dark background -->
        <div id="welcome-section">
            <h2>Welcome to Apex Athletic Club</h2>
            <h4>A Talent Factory for Promising Individuals</h4>
            <button id="build-program" class="cta-button">BUILD A SPORTS PROGRAM</button>
        </div>
    </div>

    <!-- Program selection section -->
    <div class="program-content" id="program-selection">
        <div class="program-description">
            <p>Our coaches are full-time professionals that utilize best practices from the top youth academies around the world. We offer 12 months of programming across multiple sports with the primary focus on soccer.</p>
            
            <p>Training and development within our Raptors Academy is guaranteed but placement on official Raptors teams is not. Playing on official Raptors teams is dependent on development, attendance, and performances in games. Regardless, we will have teams and games for all Apex Athletic Club players.</p>
        </div>
        <h3>Select Programs</h3>
        <!-- Indoor Soccer -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" id="indoor-soccer" name="programs" value="Indoor Soccer" checked disabled>
                <span class="sport-title">Indoor Soccer/Futsal (Required)</span>
            </div>
            <div class="sport-details">
                <div class="text-content">
                    <div class="timeline"><strong>October - February and May - August</strong></div>
                    <div class="age-group"><strong>2014s and younger</strong></div>
                    <div class="schedule"><strong>Tuesday and Saturday</strong></div>
                    <ul>
                        <li>Professional, licensed coaches</li>
                        <li>Focus on technical skills and fast-paced decision making</li>
                        <li>Small-sided games and futsal tournaments</li>
                        <li>Perfect for developing close control and creativity</li>
                    </ul>
                    <div class="location"><strong>Location: <a href="https://goo.gl/maps/h2VgMBNPgP9RmvJR6" target="_blank">XL Sports World Apex</a></strong></div>
                </div>
                <div class="image-container">
                    <img src="images/XLSWAPEX.png" alt="Indoor Soccer">
                    <img src="images/USFUTSAL.png" alt="US Futsal">
                </div>
            </div>
        </div>

        <!-- Outdoor Soccer -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" id="outdoor-soccer" name="programs" value="Outdoor Soccer" checked disabled>
                <span class="sport-title">Outdoor Soccer (Required)</span>
            </div>
            <div class="sport-details">
                <div class="text-content">
                    <div class="timeline"><strong>March - May and August - October</strong></div>
                    <div class="age-group"><strong>2014s and younger</strong></div>
                    <div class="schedule"><strong>Fridays</strong></div>
                    <ul>
                        <li>Professional, licensed coaches</li>
                        <li>Emphasis on tactical understanding and game intelligence</li>
                        <li>Competitive matches through US Club Soccer</li>
                        <li>Position-specific training</li>
                        <li>Focus on building complete players</li>
                    </ul>
                    <div class="location"><strong>Location: <a href="https://maps.app.goo.gl/Ld5YPTFVKGBxKGqb7" target="_blank">Piney Wood Park</a></strong></div>
                </div>
                <div class="image-container">
                    <img src="images/CPR.png" alt="Cary Parks">
                    <img src="images/DPR.png" alt="Durham Parks">
                    <img src="images/USCLUBSOCCER.webp" alt="US Club Soccer">
                </div>
            </div>
        </div>

        <!-- Small Group Training -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" id="small-group" name="programs" value="Small Group Training" checked disabled>
                <span class="sport-title">Small Group Training (Required)</span>
            </div>
            <div class="sport-details">
                <div class="text-content">
                    <div class="timeline"><strong>Year-round</strong></div>
                    <div class="age-group"><strong>2010s and younger</strong></div>
                    <div class="schedule"><strong>Flexible scheduling</strong></div>
                    <ul>
                        <li>Professional, licensed coaches</li>
                        <li>Maximum 4 players per coach</li>
                        <li>Personalized attention and feedback</li>
                        <li>Focused skill development</li>
                        <li>Custom training plans based on player needs</li>
                    </ul>
                    <div class="location"><strong>Location: <a href="https://www.google.com/maps/search/?api=1&query=1250+Ambergate+Station,+Apex,+NC+27502" target="_blank">Hunter Street Park</a>, <a href="https://www.google.com/maps/search/?api=1&query=2600+Evans+Rd,+Apex,+NC+27502" target="_blank">Apex Nature Park</a>, or <a href="https://www.google.com/maps/search/?api=1&query=1016+Investment+Blvd" target="_blank">XLSW Apex</a></strong></div>
                </div>
                <div class="image-container">
                    <img src="images/XLSWAPEX.png" alt="XLSW Apex">
                    <!-- Placeholder for Apex Parks Rec logo -->
                </div>
            </div>
        </div>

        <!-- Judo -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" id="judo" name="programs" value="Judo">
                <span class="sport-title">Judo</span>
            </div>
            <div class="sport-details">
                <div class="text-content">
                    <div class="timeline"><strong>October - February and May - August</strong></div>
                    <div class="age-group"><strong>2010s and younger</strong></div>
                    <div class="schedule"><strong>Wednesdays and Fridays 5:00 PM</strong></div>
                    <ul>
                        <li>Professional, licensed coaches</li>
                        <li>Led by experienced black belt instructors</li>
                        <li>Develops balance, coordination, and mental discipline</li>
                        <li>Used by top clubs like Ajax for youth training</li>
                        <li>Enhances physical and mental resilience</li>
                        <li>Builds confidence and self-defense skills</li>
                    </ul>
                    <div class="location"><strong>Location: <a href="https://www.google.com/maps/search/?api=1&query=5563+Western+Blvd,+Suite+12,+Raleigh,+NC+27606" target="_blank">Cary Judo Club</a></strong></div>
                </div>
                <div class="image-container">
                    <img src="images/CARYJUDOCLUB.png" alt="Judo">
                </div>
            </div>
        </div>

        <!-- Flag Football -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" id="flag-football" name="programs" value="Flag Football">
                <span class="sport-title">Flag Football</span>
            </div>
            <div class="sport-details">
                <div class="text-content">
                    <div class="timeline"><strong>March - May and August - October</strong></div>
                    <div class="age-group"><strong>2014s and younger</strong></div>
                    <div class="schedule"><strong>Tuesdays and Sundays</strong></div>
                    <ul>
                        <li>Non-contact skill development</li>
                        <li>Focus on agility and strategic thinking</li>
                        <li>Great for developing overall athleticism</li>
                        <li>Teaches field awareness and spatial recognition</li>
                        <li>Enhances creative thinking for set pieces in soccer</li>
                        <li>Fun way to cross-train</li>
                    </ul>
                    <div class="location"><strong>Location: <a href="https://goo.gl/maps/h2VgMBNPgP9RmvJR6" target="_blank">XL Sports World Apex</a></strong></div>
                </div>
                <div class="image-container">
                    <img src="images/XLSWAPEX.png" alt="Flag Football">
                </div>
            </div>
        </div>

        <!-- Basketball -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" name="sports" value="basketball" disabled>
                <span class="sport-title">Basketball</span>
            </div>
            <div class="sport-details">
                <p style="font-weight: bold; text-transform: uppercase;">COMING SOON</p>
            </div>
        </div>

        <!-- Tumbling Gymnastics -->
        <div class="sport-option">
            <div class="sport-header">
                <input type="checkbox" name="sports" value="tumbling-gymnastics" disabled>
                <span class="sport-title">Tumbling Gymnastics</span>
            </div>
            <div class="sport-details">
                <p style="font-weight: bold; text-transform: uppercase;">COMING SOON</p>
            </div>
        </div>

        <button id="next-step">NEXT</button>
    </div>

    <!-- Personal information and day selection section -->
    <div class="program-content" id="personal-info" style="display: none;">
        <form id="player-info-form">
            <h3>Player Information</h3>
            
            <!-- Parent section -->
            <div class="form-row parent-section">
                <div class="form-group">
                    <label for="parent-first-name">Parent First Name:</label>
                    <input type="text" id="parent-first-name" name="parent-first-name" required>
                </div>
                <div class="form-group">
                    <label for="parent-last-name">Parent Last Name:</label>
                    <input type="text" id="parent-last-name" name="parent-last-name" required>
                </div>
                <button type="button" class="add-parent-button" title="Add Parent/Guardian">+</button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="first-name">Player First Name:</label>
                    <input type="text" id="first-name" name="first-name" required>
                </div>
                <div class="form-group">
                    <label for="last-name">Player Last Name:</label>
                    <input type="text" id="last-name" name="last-name" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="birth-year">Birth Year:</label>
                    <input type="number" id="birth-year" name="birth-year" required>
                </div>
            </div>

            <h3>Program Days</h3>
            <div id="program-days"></div>

            <div class="navigation-buttons">
                <button type="button" id="go-back">Go Back</button>
                <button type="button" id="to-summary">Next</button>
            </div>
        </form>
    </div>

    <!-- Add new summary section -->
    <div class="program-content" id="summary-section" style="display: none;">
        <h3>Program Summary</h3>
        <div id="summary-content"></div>
        
        <div class="navigation-buttons">
            <button type="button" id="back-to-form">Go Back</button>
            <button type="submit" id="submit-final">Submit</button>
        </div>
    </div>

    <!-- Example snippet for invite code input -->
    <form id="inviteForm">
        <input type="text" id="inviteCodeInput" placeholder="Enter Invite Code">
        <button type="submit">Submit</button>
    </form>

    <div id="playerInfo">
        <p>Name: <span id="playerName"></span></p>
        <p>Year: <span id="playerYear"></span></p>
        <p>Phone: <span id="playerPhone"></span></p>
        <p>Email: <span id="playerEmail"></span></p>
    </div>

    <!-- Add loading div -->
    <div id="loading" style="display: none; text-align: center; margin: 20px;"></div>

    <script>
        VANTA.CELLS({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            color1: 0x045034,
            color2: 0x109963,
            size: 0.20,
            speed: 0.00
        });

        document.getElementById('build-program').addEventListener('click', function() {
            document.querySelector('.program-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        document.getElementById('next-step').addEventListener('click', function() {
            scrollToTop();
            
            const selectedPrograms = [];
            document.querySelectorAll('input[name="programs"]:checked').forEach(checkbox => {
                selectedPrograms.push(checkbox.value);
            });

            // Check if at least 2 optional programs are selected
            const optionalPrograms = selectedPrograms.filter(program => 
                !["Indoor Soccer", "Outdoor Soccer", "Small Group Training"].includes(program)
            );

            if (optionalPrograms.length < 2) {
                alert('Please select at least 2 additional programs (Judo, Flag Football, etc.)');
                return;
            }

            localStorage.setItem('selectedPrograms', JSON.stringify(selectedPrograms));
            document.getElementById('program-selection').style.display = 'none';
            document.getElementById('personal-info').style.display = 'block';
            document.getElementById('summary-section').style.display = 'none';

            // Load preloaded data if it exists
            const playerData = JSON.parse(localStorage.getItem('playerData')) || {};
            
            // Fill in the form fields
            document.getElementById('first-name').value = playerData.firstName || '';
            document.getElementById('last-name').value = playerData.lastName || '';
            document.getElementById('email').value = playerData.email || '';
            document.getElementById('phone').value = playerData.phone || '';
            document.getElementById('birth-year').value = playerData.birthYear || '';

            // Show program days based on birth year and selected programs
            const birthYear = parseInt(playerData.birthYear) || 2015;
            const programDays = document.getElementById('program-days');
            programDays.innerHTML = '';

            selectedPrograms.forEach(program => {
                if (program === "Indoor Soccer") {
                    const days = birthYear >= 2015 ? ['Tuesday', 'Saturday'] : ['Monday', 'Sunday'];
                } else if (program === "Outdoor Soccer") {
                    const days = birthYear >= 2015 ? ['Tuesday', 'Saturday'] : ['Monday', 'Sunday'];
                }
                if (program === "Judo") {
                    programDays.innerHTML += `
                        <div class="program-days-selection">
                            <h4>Judo</h4>
                            <label><input type="checkbox" name="judo-days"> Wednesday</label>
                            <label><input type="checkbox" name="judo-days"> Friday</label>
                        </div>`;
                }
                if (program === "Flag Football") {
                    programDays.innerHTML += `
                        <div class="program-days-selection">
                            <h4>Flag Football</h4>
                            <label><input type="checkbox" checked disabled> Tuesday</label>
                            <label><input type="checkbox" checked disabled> Sunday</label>
                        </div>`;
                }
                if (program === "Small Group Training") {
                    programDays.innerHTML += `
                        <div class="program-days-selection">
                            <h4>Small Group Training</h4>
                            <div class="location-options">
                                <h4>Locations</h4>
                                <label><input type="checkbox" name="sg-locations"> Hunter Street Park</label>
                                <label><input type="checkbox" name="sg-locations"> Apex Nature Park</label>
                                <label><input type="checkbox" name="sg-locations"> XLSW Apex</label>
                            </div>
                            <div class="day-options">
                                <h4>Available Days</h4>
                                <label><input type="checkbox" name="sg-days"> Monday</label>
                                <label><input type="checkbox" name="sg-days"> Tuesday</label>
                                <label><input type="checkbox" name="sg-days"> Wednesday</label>
                                <label><input type="checkbox" name="sg-days"> Thursday</label>
                                <label><input type="checkbox" name="sg-days"> Friday</label>
                                <label><input type="checkbox" name="sg-days"> Saturday</label>
                                <label><input type="checkbox" name="sg-days"> Sunday</label>
                            </div>
                        </div>`;
                }
            });
        });

        document.getElementById('player-info-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const playerData = {
                parentFirstName: formData.get('parent-first-name'),
                parentLastName: formData.get('parent-last-name'),
                firstName: formData.get('first-name'),
                lastName: formData.get('last-name'),
                birthYear: formData.get('birth-year'),
                email: formData.get('email'),
                phone: formData.get('phone')
            };
            localStorage.setItem('playerData', JSON.stringify(playerData));
            alert('Information submitted successfully!');
        });

        // Update the add parent functionality
        document.querySelector('.add-parent-button').addEventListener('click', function() {
            const parentSection = document.createElement('div');
            parentSection.className = 'form-row parent-section';
            parentSection.innerHTML = `
                <div class="form-group">
                    <label for="additional-parent-first-name">Parent First Name:</label>
                    <input type="text" name="additional-parent-first-name">
                </div>
                <div class="form-group">
                    <label for="additional-parent-last-name">Parent Last Name:</label>
                    <input type="text" name="additional-parent-last-name">
                </div>
                <button type="button" class="remove-parent-button" title="Remove Parent/Guardian">âˆ’</button>
            `;
            
            // Insert after the last parent section
            const lastParentSection = [...document.querySelectorAll('.parent-section')].pop();
            lastParentSection.after(parentSection);

            // Add remove functionality
            parentSection.querySelector('.remove-parent-button').addEventListener('click', function() {
                parentSection.remove();
            });
        });

        // Navigation functionality
        document.getElementById('go-back').addEventListener('click', function() {
            scrollToTop();
            document.getElementById('personal-info').style.display = 'none';
            document.getElementById('program-selection').style.display = 'block';
        });

        document.getElementById('to-summary').addEventListener('click', function(e) {
            e.preventDefault();
            scrollToTop(); // Call this immediately to ensure it happens first
            
            let isValid = true;
            let errorMessage = '';

            // Validate parent information
            const parentFirstName = document.getElementById('parent-first-name');
            const parentLastName = document.getElementById('parent-last-name');
            if (!parentFirstName.value.trim()) {
                errorMessage += 'Parent first name is required.\n';
                isValid = false;
            }
            if (!parentLastName.value.trim()) {
                errorMessage += 'Parent last name is required.\n';
                isValid = false;
            }
            
            // Validate player information
            const requiredFields = ['first-name', 'last-name', 'email', 'phone', 'birth-year'];
            requiredFields.forEach(field => {
                const input = document.getElementById(field);
                if (!input.value.trim()) {
                    errorMessage += `${field.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())} is required.\n`;
                    isValid = false;
                }
            });
            
            // Validate Small Group Training selections
            const smallGroupSelected = JSON.parse(localStorage.getItem('selectedPrograms')).includes('Small Group Training');
            if (smallGroupSelected) {
                const locations = document.querySelectorAll('[name="sg-locations"]:checked');
                const days = document.querySelectorAll('[name="sg-days"]:checked');
                
                if (locations.length === 0) {
                    errorMessage += 'Please select at least one location for Small Group Training.\n';
                    isValid = false;
                }
                if (days.length === 0) {
                    errorMessage += 'Please select at least one day for Small Group Training.\n';
                    isValid = false;
                }
            }
            
            // Validate Judo days if selected
            const judoSelected = JSON.parse(localStorage.getItem('selectedPrograms')).includes('Judo');
            if (judoSelected) {
                const judoDays = document.querySelectorAll('[name="judo-days"]:checked');
                if (judoDays.length === 0) {
                    errorMessage += 'Please select at least one day for Judo.\n';
                    isValid = false;
                }
            }
            
            if (!isValid) {
                alert(errorMessage); // Show popup alert with error messages
                scrollToTop(); // Ensure this is called if validation fails
                return;
            }
            
            // If all valid, proceed to summary
            // Get all form data
            const formData = new FormData(document.getElementById('player-info-form'));
            const selectedPrograms = JSON.parse(localStorage.getItem('selectedPrograms'));
            
            // Get selected days for Judo
            const selectedJudoDays = [...document.querySelectorAll('[name="judo-days"]:checked')]
                .map(cb => cb.parentElement.textContent.trim());
            
            // Get selected small group training options
            const selectedLocations = [...document.querySelectorAll('[name="sg-locations"]:checked')]
                .map(cb => cb.parentElement.textContent.trim());
            const selectedDays = [...document.querySelectorAll('[name="sg-days"]:checked')]
                .map(cb => cb.parentElement.textContent.trim());
            
            // Create summary HTML
            const summaryContent = document.getElementById('summary-content');
            summaryContent.innerHTML = `
                <div class="summary-section">
                    <div class="summary-block">
                        <h4>Player Information</h4>
                        <div class="summary-item">
                            <strong>Name:</strong> ${formData.get('first-name')} ${formData.get('last-name')}
                        </div>
                        <div class="summary-item">
                            <strong>Birth Year:</strong> ${formData.get('birth-year')}
                        </div>
                    </div>

                    <div class="summary-block">
                        <h4>Parent Information</h4>
                        <div class="summary-item">
                            <strong>Primary Parent:</strong> ${formData.get('parent-first-name')} ${formData.get('parent-last-name')}
                        </div>
                        ${[...document.querySelectorAll('[name="additional-parent-first-name"]')].map((input, i) => `
                            <div class="summary-item">
                                <strong>Additional Parent ${i + 1}:</strong> ${input.value} ${document.querySelectorAll('[name="additional-parent-last-name"]')[i].value}
                            </div>
                        `).join('')}
                    </div>

                    <div class="summary-block">
                        <h4>Contact Information</h4>
                        <div class="summary-item">
                            <strong>Email:</strong> ${formData.get('email')}
                        </div>
                        <div class="summary-item">
                            <strong>Phone:</strong> ${formData.get('phone')}
                        </div>
                    </div>

                    <div class="summary-block">
                        <h4>Selected Programs and Schedule</h4>
                        ${selectedPrograms.map(program => {
                            if (program === "Small Group Training") {
                                return `
                                    <div class="program-summary">
                                        <h5>${program}</h5>
                                        <div class="summary-item">
                                            <strong>Training Locations:</strong> ${selectedLocations.join(', ') || 'None selected'}
                                        </div>
                                        <div class="summary-item">
                                            <strong>Training Days:</strong> ${selectedDays.join(', ') || 'None selected'}
                                        </div>
                                    </div>`;
                            } else if (program === "Judo") {
                                return `
                                    <div class="program-summary">
                                        <h5>${program}</h5>
                                        <div class="summary-item">
                                            <strong>Training Days:</strong> ${selectedJudoDays.join(', ') || 'None selected'}
                                        </div>
                                    </div>`;
                            } else {
                                const birthYear = parseInt(formData.get('birth-year'));
                                let days = '';
                                if (program === "Indoor Soccer" || program === "Outdoor Soccer") {
                                    days = birthYear >= 2015 ? 'Tuesday, Saturday' : 'Monday, Sunday';
                                } else if (program === "Flag Football") {
                                    days = 'Tuesday, Sunday';
                                }
                                return `
                                    <div class="program-summary">
                                        <h5>${program}</h5>
                                        <div class="summary-item">
                                            <strong>Training Days:</strong> ${days}
                                        </div>
                                    </div>`;
                            }
                        }).join('')}
                    </div>

                    <div class="summary-block">
                        <h4>Payment Information</h4>
                        <div class="summary-item">
                            <p>Monthly Program Fee: <strong>$200.00</strong></p>
                            <p>Please complete payment via Zelle to proceed:</p>
                            <div class="zelle-info">
                                <strong>Zelle Email:</strong> brett@apexraptors.com
                                <p>Amount: $200.00</p>
                                <a href="https://enroll.zellepay.com/qr-codes?data=brett@apexraptors.com" 
                                   class="zelle-button" 
                                   target="_blank">
                                   Pay with Zelle
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('personal-info').style.display = 'none';
            document.getElementById('summary-section').style.display = 'block';
        });

        // Helper function to show error messages
        function showError(element, message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            element.classList.add('input-error');
            element.parentNode.appendChild(errorDiv);
        }

        // Update the header click event listener
        document.querySelectorAll('.sport-header').forEach(header => {
            header.addEventListener('click', function(e) {
                const checkbox = this.querySelector('input[type="checkbox"]');
                if (!checkbox.disabled && e.target !== checkbox) {  // Only toggle if not disabled and not clicking checkbox directly
                    checkbox.checked = !checkbox.checked;
                }
            });
        });

        // Add back the event listener for the back-to-form button
        document.getElementById('back-to-form').addEventListener('click', function() {
            scrollToTop();
            document.getElementById('summary-section').style.display = 'none';
            document.getElementById('personal-info').style.display = 'block';
        });

        // Update submit handler to send a cleaner format
        document.getElementById('submit-final').addEventListener('click', function(e) {
            e.preventDefault();
            scrollToTop();
            
            const formData = new FormData(document.getElementById('player-info-form'));
            const selectedPrograms = JSON.parse(localStorage.getItem('selectedPrograms'));
            
            // Create a clean formatted message
            const emailMessage = `
                APEX ATHLETIC CLUB - NEW REGISTRATION
                
                PLAYER INFORMATION
                ------------------
                Name: ${formData.get('first-name')} ${formData.get('last-name')}
                Birth Year: ${formData.get('birth-year')}
                
                PARENT INFORMATION
                -----------------
                Primary Parent: ${formData.get('parent-first-name')} ${formData.get('parent-last-name')}
                Email: ${formData.get('email')}
                Phone: ${formData.get('phone')}
                
                PROGRAM SCHEDULE
                ---------------
                ${selectedPrograms.map(program => {
                    let schedule = '';
                    if (program === "Small Group Training") {
                        const locations = [...document.querySelectorAll('[name="sg-locations"]:checked')]
                            .map(cb => cb.parentElement.textContent.trim()).join(', ');
                        const days = [...document.querySelectorAll('[name="sg-days"]:checked')]
                            .map(cb => cb.parentElement.textContent.trim()).join(', ');
                        schedule = `\n    Location: ${locations}\n    Days: ${days}`;
                    } else if (program === "Judo") {
                        const days = [...document.querySelectorAll('[name="judo-days"]:checked')]
                            .map(cb => cb.parentElement.textContent.trim()).join(', ');
                        schedule = `\n    Days: ${days}`;
                    } else if (program === "Indoor Soccer" || program === "Outdoor Soccer") {
                        const days = birthYear >= 2015 ? 'Tuesday, Saturday' : 'Monday, Sunday';
                        schedule = `\n    Days: ${days}`;
                    } else if (program === "Flag Football") {
                        schedule = '\n    Days: Tuesday, Sunday';
                    }
                    return `${program}${schedule}`;
                }).join('\n\n')}
                
                PAYMENT INFORMATION
                ------------------
                Monthly Fee: $200.00
                Payment Method: Zelle
                Payment Email: brett@apexraptors.com
            `.replace(/^\s+/gm, ''); // Remove leading whitespace

            // First send admin notification
            emailjs.send("service_jqvfs2x", "template_3ls7ajq", {
                to_email: "brett@apexraptors.com",
                from_name: `${formData.get('first-name')} ${formData.get('last-name')}`,
                player_name: `${formData.get('first-name')} ${formData.get('last-name')}`,
                birth_year: formData.get('birth-year'),
                parent_name: `${formData.get('parent-first-name')} ${formData.get('parent-last-name')}`,
                email: formData.get('email'),
                phone: formData.get('phone'),
                message: emailMessage
            }).then(function(response) {
                // Then send confirmation to player
                return emailjs.send("service_jqvfs2x", "template_3ls7ajq", {
                    to_email: formData.get('email'),
                    from_name: "Apex Athletic Club",
                    player_name: `${formData.get('first-name')} ${formData.get('last-name')}`,
                    birth_year: formData.get('birth-year'),
                    parent_name: `${formData.get('parent-first-name')} ${formData.get('parent-last-name')}`,
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    message: `Thank you for registering with Apex Athletic Club!\n\n${emailMessage}`
                });
            }).then(
                function(response) {
                    alert("Registration submitted successfully! You will receive a confirmation email shortly.");
                    window.location.href = '/';
                },
                function(error) {
                    console.log("FAILED", error);
                    alert(`Error submitting registration: ${error.text}`);
                }
            );
        });

        // Update the scrollToTop function to ensure it targets the correct element
        function scrollToTop() {
            const whiteBackgroundElement = document.querySelector('.program-content');
            if (whiteBackgroundElement) {
                const rect = whiteBackgroundElement.getBoundingClientRect();
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                window.scrollTo({
                    top: rect.top + scrollTop,
                    behavior: 'smooth'
                });
            }
        }

        document.getElementById('inviteForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const inviteCode = document.getElementById('inviteCodeInput').value;
            if (inviteCode) {
                handleInviteCode(inviteCode);
            }
        });

        // Update the program details sections to be consistent
        const sportDetails = {
            "Indoor Soccer": {
                timeline: "October - February and May - August",
                schedule: "Tuesdays and Saturdays"
            },
            "Outdoor Soccer": {
                timeline: "March - May and August - October",
                schedule: "Fridays"
            },
            "Judo": {
                timeline: "October - February and May - August",
                schedule: "Wednesdays and Fridays 5:00 PM"
            },
            "Flag Football": {
                timeline: "March - May and August - October",
                schedule: "Tuesdays and Sundays"
            }
        };

        // Add loading state and validation for invite codes
        function handleInviteCode(code) {
            const validCodes = ['ELLIOT2025', 'COOPER2025'];
            const loadingDiv = document.getElementById('loading');
            loadingDiv.style.display = 'block';
            loadingDiv.textContent = 'Checking invite code...';

            // Simulate network delay for 1.5 seconds
            setTimeout(() => {
                if (validCodes.includes(code)) {
                    // Keep the loading message visible
                    loadingDiv.textContent = 'Valid invite code - redirecting...';
                    // Wait another second before redirecting
                    setTimeout(() => {
                        window.location.href = `program.html?invite_code=${code}`;
                    }, 1000);
                } else {
                    loadingDiv.textContent = 'Invalid invite code';
                    setTimeout(() => {
                        loadingDiv.style.display = 'none';
                    }, 2000);
                }
            }, 1500);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteCode = urlParams.get('invite_code');

            if (inviteCode) {
                displayPlayerInfo(inviteCode);
            }
        });

        function displayPlayerInfo(code) {
            const playerInfo = {
                'ELLIOT2025': { name: 'Elliot Haxell', year: 2016, phone: '(919) 622-5755', email: 'susanna.haxell@gmail.com' },
                'COOPER2025': { name: 'Cooper Young', year: 2017, phone: '(919) 624-1961', email: 'laurafranklin919@aol.com' }
            };

            const info = playerInfo[code];
            if (info) {
                document.getElementById('playerName').textContent = info.name;
                document.getElementById('playerYear').textContent = info.year;
                document.getElementById('playerPhone').textContent = info.phone;
                document.getElementById('playerEmail').textContent = info.email;
            }
        }
    </script>
</body>
</html> 